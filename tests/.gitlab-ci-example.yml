image: ubuntu:22.04

variables:
  QT_VERSION: "6.8.0"
  QT_QPA_PLATFORM: "offscreen"
  DEBIAN_FRONTEND: "noninteractive"

stages:
  - build
  - test

before_script:
  - apt-get update -qq
  - apt-get install -y -qq \
      build-essential \
      cmake \
      ninja-build \
      git \
      wget \
      libgl1-mesa-dev \
      libglu1-mesa-dev \
      libxkbcommon-x11-0 \
      libxcb-icccm4 \
      libxcb-image0 \
      libxcb-keysyms1 \
      libxcb-randr0 \
      libxcb-render-util0 \
      libxcb-xinerama0
  # Install Qt - you may want to use aqtinstall for this
  # pip install aqtinstall
  # aqt install-qt linux desktop ${QT_VERSION} gcc_64

build:
  stage: build
  script:
    - cd qmlPrayerTimes
    - cmake -B build -S . -DCMAKE_BUILD_TYPE=Release -GNinja
    - cmake --build build
  artifacts:
    paths:
      - qmlPrayerTimes/build/
    expire_in: 1 hour

test:
  stage: test
  dependencies:
    - build
  script:
    - cd qmlPrayerTimes/build
    - ctest --output-on-failure --verbose
  artifacts:
    when: always
    reports:
      junit: qmlPrayerTimes/build/Testing/**/*.xml
    paths:
      - qmlPrayerTimes/build/Testing/
    expire_in: 1 week
